<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Player</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    position: relative;
    overflow-x: hidden;
    transition: background 0.6s ease;
  }

  body::before {
    content: '';
    position: fixed;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
    background-size: 50px 50px;
    animation: backgroundMove 20s linear infinite;
    pointer-events: none;
  }

  @keyframes backgroundMove {
    0% { transform: translate(0, 0); }
    100% { transform: translate(50px, 50px); }
  }

  .container {
    max-width: 1200px;
    width: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 40px;
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.6);
    position: relative;
    z-index: 1;
    transition: border 0.6s ease;
  }

  h1 {
    color: white;
    font-size: 2.5rem;
    margin-bottom: 30px;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    font-weight: 700;
  }

  .view-controls {
    display: flex;
    gap: 12px;
    margin-bottom: 30px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .view-btn {
    padding: 12px 28px;
    border: 1px solid;
    color: white;
    cursor: pointer;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .view-btn:hover {
    transform: translateY(-2px);
  }

  .view-btn.active {
    transform: translateY(-2px);
  }

  /* Filter Controls */
  .filter-section {
    margin-bottom: 30px;
  }

  .filter-group {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 16px;
  }

  .filter-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
    text-align: center;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .filter-btn {
    padding: 8px 20px;
    border: 1px solid;
    color: white;
    cursor: pointer;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .filter-btn:hover {
    transform: translateY(-2px);
  }

  .filter-btn.active {
    transform: translateY(-2px);
  }

  /* Artists Grid */
  .artists-section {
    margin-bottom: 30px;
  }

  .artist-card {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
    border: 1px solid;
    backdrop-filter: blur(10px);
  }

  .artist-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .artist-header:hover {
    transform: translateX(4px);
  }

  .artist-initial {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    font-weight: 700;
    color: white;
    flex-shrink: 0;
  }

  .artist-info h2 {
    color: white;
    font-size: 1.8rem;
    margin-bottom: 4px;
  }

  .artist-meta {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.95rem;
  }

  .expand-icon {
    margin-left: auto;
    color: white;
    font-size: 1.5rem;
    transition: transform 0.3s ease;
  }

  .artist-card.expanded .expand-icon {
    transform: rotate(180deg);
  }

  .artist-albums {
    display: none;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .artist-card.expanded .artist-albums {
    display: grid;
  }

  /* Albums Grid */
  .albums-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 24px;
    margin-bottom: 30px;
  }

  .album-card {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 16px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid;
    backdrop-filter: blur(10px);
    position: relative;
  }

  .album-card:hover {
    transform: translateY(-8px);
  }

  .album-card img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-radius: 12px;
    margin-bottom: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }

  .album-card .album-title {
    color: white;
    font-weight: 600;
    font-size: 1.1rem;
    text-align: center;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    margin-bottom: 4px;
  }

  .album-card .album-artist {
    color: rgba(255, 255, 255, 0.85);
    font-size: 0.95rem;
    font-weight: 500;
    text-align: center;
    margin-bottom: 8px;
  }

  .album-date {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    font-weight: 400;
    text-align: center;
  }

  /* Like button on album cards */
  .like-btn {
    position: absolute;
    top: 28px;
    right: 28px;
    background: rgba(0, 0, 0, 0.7);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.2rem;
    transition: all 0.3s ease;
    z-index: 10;
  }

  .like-btn:hover {
    transform: scale(1.1);
    background: rgba(0, 0, 0, 0.9);
  }

  .like-btn.liked {
    background: rgba(220, 38, 38, 0.9);
  }

  /* Track List */
  .track-view {
    animation: fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .track-header {
    display: flex;
    align-items: center;
    gap: 24px;
    margin-bottom: 30px;
    padding: 24px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 16px;
    backdrop-filter: blur(10px);
    border: 1px solid;
  }

  .track-header img {
    width: 150px;
    height: 150px;
    border-radius: 12px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.3);
  }

  .track-header-info {
    flex: 1;
  }

  .track-header h2 {
    color: white;
    font-size: 2rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    margin-bottom: 4px;
  }

  .track-header .artist-name {
    color: rgba(255, 255, 255, 0.85);
    font-size: 1.2rem;
    font-weight: 500;
    margin-bottom: 8px;
  }

  .track-header .release-date {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1rem;
    font-weight: 400;
  }

  .track-header-actions {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .album-like-btn {
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 50px;
    padding: 12px 24px;
    color: white;
    cursor: pointer;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
  }

  .album-like-btn:hover {
    transform: scale(1.05);
  }

  .album-like-btn.liked {
    background: rgba(220, 38, 38, 0.9);
    border-color: rgba(220, 38, 38, 1);
  }

  .add-to-playlist-btn {
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 50px;
    padding: 12px 24px;
    color: white;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.3s ease;
    font-weight: 600;
  }

  .add-to-playlist-btn:hover {
    transform: scale(1.05);
  }

  .tracks {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .track-item {
    padding: 16px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 12px;
    border: 1px solid transparent;
  }

  .track-item:hover {
    transform: translateX(4px);
  }

  .track-number {
    font-weight: 600;
    min-width: 30px;
  }

  .track-title {
    color: white;
    font-weight: 500;
    flex: 1;
  }

  .track-item.current .track-title {
    font-weight: 700;
  }

  .track-actions {
    display: flex;
    gap: 12px;
    align-items: center;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .track-item:hover .track-actions,
  .track-item.current .track-actions {
    opacity: 1;
  }

  .track-like-btn {
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    font-size: 1.2rem;
    transition: all 0.2s ease;
  }

  .track-like-btn:hover {
    transform: scale(1.1);
  }

  .track-like-btn.liked {
    color: #dc2626;
  }

  .play-icon {
    opacity: 0;
    color: white;
    font-size: 1.2rem;
  }

  .track-item:hover .play-icon,
  .track-item.current .play-icon {
    opacity: 1;
  }

  /* Playlists Section */
  .playlists-section {
    margin-bottom: 30px;
  }

  .create-playlist-btn {
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid;
    border-radius: 16px;
    padding: 20px;
    color: white;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    width: 100%;
    margin-bottom: 24px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
  }

  .create-playlist-btn:hover {
    transform: translateY(-4px);
  }

  .playlist-card {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    border: 1px solid;
    backdrop-filter: blur(10px);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .playlist-card:hover {
    transform: translateY(-4px);
  }

  .playlist-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 12px;
  }

  .playlist-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    flex-shrink: 0;
  }

  .playlist-info {
    flex: 1;
  }

  .playlist-info h3 {
    color: white;
    font-size: 1.5rem;
    margin-bottom: 4px;
  }

  .playlist-meta {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
  }

  .playlist-delete-btn {
    background: rgba(220, 38, 38, 0.2);
    border: 1px solid rgba(220, 38, 38, 0.5);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #dc2626;
    font-size: 1.1rem;
    transition: all 0.3s ease;
  }

  .playlist-delete-btn:hover {
    background: rgba(220, 38, 38, 0.4);
    transform: scale(1.1);
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal.active {
    display: flex;
  }

  .modal-content {
    background: rgba(20, 20, 20, 0.95);
    border-radius: 24px;
    padding: 40px;
    max-width: 500px;
    width: 100%;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .modal-content h2 {
    color: white;
    font-size: 1.8rem;
    margin-bottom: 24px;
    text-align: center;
  }

  .modal-input {
    width: 100%;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 12px;
    padding: 16px;
    color: white;
    font-size: 1rem;
    margin-bottom: 24px;
    font-family: inherit;
  }

  .modal-input:focus {
    outline: none;
    border-color: rgba(255, 255, 255, 0.5);
  }

  .modal-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
  }

  .modal-buttons {
    display: flex;
    gap: 12px;
  }

  .modal-btn {
    flex: 1;
    padding: 14px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 12px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .modal-btn.primary {
    background: white;
    color: black;
  }

  .modal-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: white;
  }

  .modal-btn:hover {
    transform: translateY(-2px);
  }

  .playlist-select-list {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 20px;
  }

  .playlist-select-item {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .playlist-select-item:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateX(4px);
  }

  .playlist-select-item span {
    color: white;
    font-weight: 500;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: rgba(255, 255, 255, 0.6);
  }

  .empty-state-icon {
    font-size: 4rem;
    margin-bottom: 16px;
  }

  .empty-state-text {
    font-size: 1.2rem;
    margin-bottom: 8px;
  }

  .empty-state-subtext {
    font-size: 0.95rem;
  }

  /* Player Controls */
  .player-section {
    margin-top: 40px;
    padding-top: 30px;
    border-top: 1px solid;
  }

  .now-playing {
    text-align: center;
    margin-bottom: 20px;
  }

  .now-playing-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .now-playing-title {
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  }

  .now-playing-artist {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
    font-weight: 500;
    margin-top: 4px;
  }

  /* Progress Bar */
  .progress-container {
    margin-bottom: 24px;
    padding: 0 8px;
  }

  .time-display {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    font-weight: 500;
  }

  .progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    width: 0%;
    border-radius: 4px;
    transition: width 0.1s linear;
    position: relative;
  }

  .progress-fill::after {
    content: '';
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 14px;
    height: 14px;
    background: white;
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  .progress-bar:hover .progress-fill::after {
    opacity: 1;
  }

  .player-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    margin-bottom: 16px;
  }

  .player-controls button {
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid;
    cursor: pointer;
    border-radius: 50%;
    width: 56px;
    height: 56px;
    font-size: 1.3rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    color: white;
  }

  .player-controls button:hover {
    transform: scale(1.1);
  }

  .player-controls button.play-pause {
    width: 72px;
    height: 72px;
    font-size: 1.8rem;
    border: 2px solid;
  }

  .status {
    text-align: center;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.95rem;
    margin-top: 12px;
  }

  /* Volume Control */
  .volume-control {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-top: 24px;
    padding: 0 20px;
  }

  .volume-icon {
    color: white;
    font-size: 1.2rem;
    min-width: 24px;
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .volume-icon:hover {
    transform: scale(1.1);
  }

  .volume-slider {
    width: 200px;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    position: relative;
    cursor: pointer;
    overflow: hidden;
  }

  .volume-fill {
    height: 100%;
    width: 100%;
    border-radius: 4px;
    transition: width 0.1s ease;
    position: relative;
  }

  .volume-fill::after {
    content: '';
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 14px;
    height: 14px;
    background: white;
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  .volume-slider:hover .volume-fill::after {
    opacity: 1;
  }

  .volume-percentage {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    font-weight: 600;
    min-width: 40px;
    text-align: right;
  }

  .back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid;
    cursor: pointer;
    border-radius: 50px;
    font-size: 0.95rem;
    margin-bottom: 20px;
    transition: all 0.3s ease;
    color: white;
  }

  .back-btn:hover {
    transform: translateX(-4px);
  }

  /* Hidden audio element */
  #audio {
    display: none;
  }

  @media (max-width: 768px) {
    .container {
      padding: 24px;
    }

    h1 {
      font-size: 2rem;
    }

    .albums-grid,
    .artist-albums {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
    }

    .track-header {
      flex-direction: column;
      text-align: center;
    }

    .track-header-actions {
      width: 100%;
      justify-content: center;
    }

    .volume-slider {
      width: 120px;
    }

    .artist-header h2 {
      font-size: 1.4rem;
    }

    .artist-initial {
      width: 50px;
      height: 50px;
      font-size: 1.4rem;
    }
  }
</style>
</head>
<body>

<div class="container">
  <h1>üéµ Music Player</h1>

  <div class="view-controls">
    <button class="view-btn active" onclick="setView('artists')">By Artist</button>
    <button class="view-btn" onclick="setView('albums')">All Albums</button>
    <button class="view-btn" onclick="setView('chronological')">Chronological</button>
    <button class="view-btn" onclick="setView('playlists')">üìù Playlists</button>
    <button class="view-btn" onclick="setView('liked')">‚ù§Ô∏è Liked</button>
  </div>

  <div id="view"></div>

  <div class="player-section">
    <div class="now-playing">
      <div class="now-playing-label">Now Playing</div>
      <div class="now-playing-title" id="nowPlayingTitle">Select a track</div>
      <div class="now-playing-artist" id="nowPlayingArtist"></div>
    </div>

    <div class="progress-container">
      <div class="time-display">
        <span id="currentTime">0:00</span>
        <span id="duration">0:00</span>
      </div>
      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <div class="player-controls">
      <button onclick="toggleShuffle()" id="shuffleBtn" title="Shuffle">üîÄ</button>
      <button onclick="prev()" title="Previous">‚èÆ</button>
      <button class="play-pause" onclick="playPause()" title="Play/Pause">‚ñ∂</button>
      <button onclick="next()" title="Next">‚è≠</button>
      <button onclick="toggleRepeat()" id="repeatBtn" title="Repeat Off">üîÅ</button>
    </div>

    <p class="status" id="status">Ready to play</p>

    <div class="volume-control">
      <span class="volume-icon" onclick="toggleMute()" id="volumeIcon">üîä</span>
      <div class="volume-slider" id="volumeSlider">
        <div class="volume-fill" id="volumeFill"></div>
      </div>
      <span class="volume-percentage" id="volumePercentage">100%</span>
    </div>
  </div>
</div>

<!-- Create Playlist Modal -->
<div class="modal" id="createPlaylistModal">
  <div class="modal-content">
    <h2>Create New Playlist</h2>
    <input type="text" class="modal-input" id="playlistNameInput" placeholder="Playlist name">
    <div class="modal-buttons">
      <button class="modal-btn secondary" onclick="closeCreatePlaylistModal()">Cancel</button>
      <button class="modal-btn primary" onclick="createPlaylist()">Create</button>
    </div>
  </div>
</div>

<!-- Add to Playlist Modal -->
<div class="modal" id="addToPlaylistModal">
  <div class="modal-content">
    <h2>Add to Playlist</h2>
    <div class="playlist-select-list" id="playlistSelectList"></div>
    <div class="modal-buttons">
      <button class="modal-btn secondary" onclick="closeAddToPlaylistModal()">Cancel</button>
    </div>
  </div>
</div>

<audio id="audio"></audio>

<script>
// ====== DATA ======
const library = {
  artists: [
    {
      name: "Nirvana",
      albums: [
        {
          title: "Bleach",
          cover: "71ThvtmT-FL._SL1417_.jpg",
          releaseDate: "1989-06-15",
          displayDate: "June 15, 1989",
          theme: {
            background: "linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #2d2d2d 100%)",
            primary: "#ffffff",
            primaryRgb: "255, 255, 255",
            accent: "#cccccc"
          },
          tracks: [
            {title: "Blew", file: "audio/blew.m4a"},
            {title: "Floyd the Barber", file: "audio/barber.m4a"},
            {title: "About a Girl", file: "audio/abt.m4a"},
            {title: "School", file: "audio/school.m4a"},
            {title: "Love Buzz", file: "audio/lovebuzz.m4a"},
            {title: "Paper Cuts", file: "audio/paper.m4a"},
            {title: "Negative Creep", file: "audio/negative.m4a"},
            {title: "Scoff", file: "audio/scoff.m4a"},
            {title: "Swap Meet", file: "audio/swap.m4a"},
            {title: "Mr. Moustache", file: "audio/mrm.m4a"},
            {title: "Sifting", file: "audio/sift.m4a"},
            {title: "Big Cheese", file: "audio/bigcheese.m4a"},
            {title: "Downer", file: "audio/down.m4a"},
          ]
        },
        {
          title: "Nevermind",
          cover: "https://upload.wikimedia.org/wikipedia/en/b/b7/NirvanaNevermindalbumcover.jpg",
          releaseDate: "1991-09-24",
          displayDate: "September 24, 1991",
          theme: {
            background: "linear-gradient(135deg, #1e3a5f 0%, #2d5a8c 50%, #4a7ba7 100%)",
            primary: "#4a7ba7",
            primaryRgb: "74, 123, 167",
            accent: "#6ba3d4"
          },
          tracks: [
            {title: "Smells Like Teen Spirit", file: "audio/smells_like_teen_spirit.mp3"},
            {title: "In Bloom", file: "audio/in_bloom.mp3"},
            {title: "Come As You Are", file: "audio/come_as_you_are.mp3"},
            {title: "Breed", file: "audio/breed.mp3"},
            {title: "Lithium", file: "audio/lithium.m4a"},
            {title: "Polly", file: "audio/polly.m4a"},
            {title: "Territorial Pissing", file: "audio/territorial_pissings.m4a"},
            {title: "Drain You", file: "audio/drain_you.mp3"},
            {title: "Lounge Act", file: "audio/lounge_act.mp3"},
            {title: "Stay Away", file: "audio/stay_away.m4a"},
            {title: "On A Plain", file: "audio/on_a_plain.m4a"},
            {title: "Something In The Way", file: "audio/something_in_the_way.m4a"},
          ]
        },
        {
          title: "In Utero",
          cover: "ab67616d0000b273c4f52ef8782f0e8ede4c1aaf.jfif",
          releaseDate: "1993-09-21",
          displayDate: "September 21, 1993",
          theme: {
            background: "linear-gradient(135deg, #e8dcc0 0%, #d4c4a0 50%, #c0b090 100%)",
            primary: "#7a3e3e",
            primaryRgb: "122, 62, 62",
            accent: "#9a5555"
          },
          tracks: [
            {title: "Serve The Servants", file: "audio/serve.m4a"},
            {title: "Scentless Apprentice", file: "audio/scentless.m4a"},
            {title: "Heart Shaped Box", file: "audio/hear.m4a"},
            {title: "Rape Me", file: "audio/me.m4a"},
            {title: "Frances Farmer Will Have Her Revenge On Seattle", file: "audio/frances.m4a"},
            {title: "Dumb", file: "audio/dumb.m4a"},
            {title: "Very Ape", file: "audio/very.m4a"},
            {title: "Milk It", file: "audio/milk.m4a"},
            {title: "Pennyroyal Tea", file: "audio/penny.m4a"},
            {title: "Radio Friendly Unit Shifter", file: "audio/radio.m4a"},
            {title: "Tourette's", file: "audio/tour.m4a"},
            {title: "All Apologies", file: "audio/apologies.m4a"},
          ]
        }
      ]
    }
  ]
};

// User data (stored in localStorage)
let playlists = JSON.parse(localStorage.getItem('playlists')) || [];
let likedAlbums = JSON.parse(localStorage.getItem('likedAlbums')) || [];
let likedSongs = JSON.parse(localStorage.getItem('likedSongs')) || [];

let currentView = 'artists';
let currentArtistIndex = 0;
let currentAlbumIndex = 0;
let currentTrackIndex = 0;
let currentPlaylistId = null;
let currentPlaylistIndex = -1; // Track position in playlist
const audio = document.getElementById("audio");
const viewDiv = document.getElementById("view");
const status = document.getElementById("status");
const nowPlayingTitle = document.getElementById("nowPlayingTitle");
const nowPlayingArtist = document.getElementById("nowPlayingArtist");
const progressBar = document.getElementById("progressBar");
const progressFill = document.getElementById("progressFill");
const currentTimeEl = document.getElementById("currentTime");
const durationEl = document.getElementById("duration");
const volumeSlider = document.getElementById("volumeSlider");
const volumeFill = document.getElementById("volumeFill");
const volumePercentage = document.getElementById("volumePercentage");
const volumeIcon = document.getElementById("volumeIcon");

// Initialize volume
audio.volume = 1.0;
let previousVolume = 1.0;
let isShuffleOn = false;
let repeatMode = 'off';
let shuffleOrder = [];
let shuffleIndex = 0;

// ====== HELPER FUNCTIONS ======
function getAllAlbums() {
  const allAlbums = [];
  library.artists.forEach((artist, artistIdx) => {
    artist.albums.forEach((album, albumIdx) => {
      allAlbums.push({
        ...album,
        artistName: artist.name,
        artistIndex: artistIdx,
        albumIndex: albumIdx
      });
    });
  });
  return allAlbums;
}

function getAlbumsSortedByDate() {
  return getAllAlbums().sort((a, b) => 
    new Date(a.releaseDate) - new Date(b.releaseDate)
  );
}

function getAlbumKey(artistIdx, albumIdx) {
  return `${artistIdx}-${albumIdx}`;
}

function getTrackKey(artistIdx, albumIdx, trackIdx) {
  return `${artistIdx}-${albumIdx}-${trackIdx}`;
}

function isAlbumLiked(artistIdx, albumIdx) {
  return likedAlbums.includes(getAlbumKey(artistIdx, albumIdx));
}

function isTrackLiked(artistIdx, albumIdx, trackIdx) {
  return likedSongs.includes(getTrackKey(artistIdx, albumIdx, trackIdx));
}

function saveData() {
  localStorage.setItem('playlists', JSON.stringify(playlists));
  localStorage.setItem('likedAlbums', JSON.stringify(likedAlbums));
  localStorage.setItem('likedSongs', JSON.stringify(likedSongs));
}

// ====== LIKE FUNCTIONS ======
function toggleAlbumLike(artistIdx, albumIdx, event) {
  if (event) event.stopPropagation();
  
  const key = getAlbumKey(artistIdx, albumIdx);
  const index = likedAlbums.indexOf(key);
  
  if (index > -1) {
    likedAlbums.splice(index, 1);
  } else {
    likedAlbums.push(key);
  }
  
  saveData();
  
  // Update UI
  const btn = event?.target;
  if (btn) {
    btn.textContent = isAlbumLiked(artistIdx, albumIdx) ? '‚ù§Ô∏è' : 'ü§ç';
    btn.classList.toggle('liked');
  }
}

function toggleTrackLike(artistIdx, albumIdx, trackIdx, event) {
  if (event) event.stopPropagation();
  
  const key = getTrackKey(artistIdx, albumIdx, trackIdx);
  const index = likedSongs.indexOf(key);
  
  if (index > -1) {
    likedSongs.splice(index, 1);
  } else {
    likedSongs.push(key);
  }
  
  saveData();
  
  // Update UI
  const btn = event?.target;
  if (btn) {
    btn.textContent = isTrackLiked(artistIdx, albumIdx, trackIdx) ? '‚ù§Ô∏è' : 'ü§ç';
    btn.classList.toggle('liked');
  }
}

// ====== PLAYLIST FUNCTIONS ======
function openCreatePlaylistModal() {
  document.getElementById('createPlaylistModal').classList.add('active');
  document.getElementById('playlistNameInput').value = '';
  document.getElementById('playlistNameInput').focus();
}

function closeCreatePlaylistModal() {
  document.getElementById('createPlaylistModal').classList.remove('active');
}

function createPlaylist() {
  const name = document.getElementById('playlistNameInput').value.trim();
  
  if (!name) {
    alert('Please enter a playlist name');
    return;
  }
  
  const playlist = {
    id: Date.now().toString(),
    name: name,
    tracks: [],
    createdAt: new Date().toISOString()
  };
  
  playlists.push(playlist);
  saveData();
  closeCreatePlaylistModal();
  
  if (currentView === 'playlists') {
    showPlaylistsView();
  }
}

function deletePlaylist(playlistId, event) {
  event.stopPropagation();
  
  if (confirm('Are you sure you want to delete this playlist?')) {
    playlists = playlists.filter(p => p.id !== playlistId);
    saveData();
    showPlaylistsView();
  }
}

function openAddToPlaylistModal(artistIdx, albumIdx) {
  currentPlaylistId = getAlbumKey(artistIdx, albumIdx);
  
  const listEl = document.getElementById('playlistSelectList');
  
  if (playlists.length === 0) {
    listEl.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">üìù</div>
        <div class="empty-state-text">No playlists yet</div>
        <div class="empty-state-subtext">Create a playlist first!</div>
      </div>
    `;
  } else {
    listEl.innerHTML = playlists.map(playlist => `
      <div class="playlist-select-item" onclick="addAlbumToPlaylist('${playlist.id}', ${artistIdx}, ${albumIdx})">
        <span>üìù</span>
        <span>${playlist.name}</span>
      </div>
    `).join('');
  }
  
  document.getElementById('addToPlaylistModal').classList.add('active');
}

function closeAddToPlaylistModal() {
  document.getElementById('addToPlaylistModal').classList.remove('active');
  currentPlaylistId = null;
}

function addAlbumToPlaylist(playlistId, artistIdx, albumIdx) {
  const playlist = playlists.find(p => p.id === playlistId);
  const album = library.artists[artistIdx].albums[albumIdx];
  
  // Add all tracks from the album
  album.tracks.forEach((track, trackIdx) => {
    const trackData = {
      artistIdx,
      albumIdx,
      trackIdx,
      artistName: library.artists[artistIdx].name,
      albumTitle: album.title,
      trackTitle: track.title,
      file: track.file
    };
    
    // Avoid duplicates
    const exists = playlist.tracks.some(t => 
      t.artistIdx === artistIdx && 
      t.albumIdx === albumIdx && 
      t.trackIdx === trackIdx
    );
    
    if (!exists) {
      playlist.tracks.push(trackData);
    }
  });
  
  saveData();
  closeAddToPlaylistModal();
  status.textContent = `‚úì Album added to "${playlist.name}"`;
  setTimeout(() => status.textContent = 'Ready to play', 2000);
}

function showPlaylist(playlistId) {
  const playlist = playlists.find(p => p.id === playlistId);
  if (!playlist) return;
  
  const theme = library.artists[currentArtistIndex].albums[currentAlbumIndex].theme;
  
  if (playlist.tracks.length === 0) {
    viewDiv.innerHTML = `
      <button class="back-btn" onclick="setView('playlists')">‚Üê Back to Playlists</button>
      <div class="empty-state">
        <div class="empty-state-icon">üéµ</div>
        <div class="empty-state-text">No tracks in this playlist</div>
        <div class="empty-state-subtext">Add albums to your playlist to see them here</div>
      </div>
    `;
    return;
  }
  
  const tracksHTML = playlist.tracks.map((track, idx) => `
    <div class="track-item" onclick="playPlaylistTrack('${playlistId}', ${idx})">
      <span class="track-number">${idx + 1}</span>
      <span class="track-title">${track.trackTitle}</span>
      <span style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">${track.artistName} ‚Ä¢ ${track.albumTitle}</span>
      <div class="track-actions">
        <button class="track-like-btn ${isTrackLiked(track.artistIdx, track.albumIdx, track.trackIdx) ? 'liked' : ''}" 
                onclick="toggleTrackLike(${track.artistIdx}, ${track.albumIdx}, ${track.trackIdx}, event)">
          ${isTrackLiked(track.artistIdx, track.albumIdx, track.trackIdx) ? '‚ù§Ô∏è' : 'ü§ç'}
        </button>
        <span class="play-icon">‚ñ∂</span>
      </div>
    </div>
  `).join('');
  
  viewDiv.innerHTML = `
    <button class="back-btn" onclick="setView('playlists')">‚Üê Back to Playlists</button>
    <div class="track-view">
      <div class="track-header">
        <div class="playlist-icon" style="background: ${theme.primary}; color: ${theme.primary === '#ffffff' ? '#000' : '#fff'};">üìù</div>
        <div class="track-header-info">
          <h2>${playlist.name}</h2>
          <p class="artist-name">${playlist.tracks.length} tracks</p>
        </div>
      </div>
      <div class="tracks">
        ${tracksHTML}
      </div>
    </div>
  `;
  
  updateThemedElements(theme);
}

function playPlaylistTrack(playlistId, trackIndex) {
  const playlist = playlists.find(p => p.id === playlistId);
  const track = playlist.tracks[trackIndex];
  
  // Set playlist context
  currentPlaylistId = playlistId;
  currentPlaylistIndex = trackIndex;
  
  currentArtistIndex = track.artistIdx;
  currentAlbumIndex = track.albumIdx;
  currentTrackIndex = track.trackIdx;
  
  applyTheme(currentArtistIndex, currentAlbumIndex);
  loadTrack();
  audio.play();
}

// ====== THEME FUNCTIONS ======
function applyTheme(artistIdx, albumIdx) {
  const theme = library.artists[artistIdx].albums[albumIdx].theme;
  document.body.style.background = theme.background;
  
  document.documentElement.style.setProperty('--primary-color', theme.primary);
  document.documentElement.style.setProperty('--primary-rgb', theme.primaryRgb);
  document.documentElement.style.setProperty('--accent-color', theme.accent);
  
  const container = document.querySelector('.container');
  container.style.borderColor = `rgba(${theme.primaryRgb}, 0.3)`;
  
  updateThemedElements(theme);
}

function updateThemedElements(theme) {
  document.querySelectorAll('.view-btn').forEach(btn => {
    btn.style.background = `rgba(${theme.primaryRgb}, 0.2)`;
    btn.style.borderColor = `rgba(${theme.primaryRgb}, 0.4)`;
    if (btn.classList.contains('active')) {
      btn.style.background = theme.primary;
      btn.style.borderColor = `rgba(${theme.primaryRgb}, 0.8)`;
      btn.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
    }
  });
  
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.style.background = `rgba(${theme.primaryRgb}, 0.2)`;
    btn.style.borderColor = `rgba(${theme.primaryRgb}, 0.4)`;
    if (btn.classList.contains('active')) {
      btn.style.background = theme.primary;
      btn.style.borderColor = `rgba(${theme.primaryRgb}, 0.8)`;
      btn.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
    }
  });
  
  document.querySelectorAll('.artist-card, .album-card, .playlist-card').forEach(card => {
    card.style.borderColor = `rgba(${theme.primaryRgb}, 0.2)`;
  });
  
  document.querySelectorAll('.artist-initial, .playlist-icon').forEach(initial => {
    initial.style.background = theme.primary;
    initial.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
  });
  
  document.querySelectorAll('.track-item').forEach(item => {
    if (item.classList.contains('current')) {
      item.style.background = `rgba(${theme.primaryRgb}, 0.25)`;
      item.style.borderColor = `rgba(${theme.primaryRgb}, 0.6)`;
    }
  });
  
  document.querySelectorAll('.track-number').forEach(num => {
    num.style.color = `rgba(${theme.primaryRgb}, 0.7)`;
  });
  
  document.querySelectorAll('.track-item.current .track-number').forEach(num => {
    num.style.color = theme.primary;
  });
  
  const playerSection = document.querySelector('.player-section');
  if (playerSection) {
    playerSection.style.borderTopColor = `rgba(${theme.primaryRgb}, 0.3)`;
  }
  
  document.querySelectorAll('.player-controls button').forEach(btn => {
    btn.style.borderColor = `rgba(${theme.primaryRgb}, 0.4)`;
    btn.style.color = theme.primary;
    
    if (btn.classList.contains('play-pause')) {
      btn.style.background = theme.primary;
      btn.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
      btn.style.boxShadow = `0 4px 16px rgba(${theme.primaryRgb}, 0.4)`;
    }
  });
  
  progressFill.style.background = theme.primary;
  volumeFill.style.background = theme.primary;
  
  const backBtn = document.querySelector('.back-btn');
  if (backBtn) {
    backBtn.style.borderColor = `rgba(${theme.primaryRgb}, 0.4)`;
    backBtn.style.color = theme.primary;
  }
  
  const trackHeader = document.querySelector('.track-header');
  if (trackHeader) {
    trackHeader.style.borderColor = `rgba(${theme.primaryRgb}, 0.3)`;
  }
  
  const createPlaylistBtn = document.querySelector('.create-playlist-btn');
  if (createPlaylistBtn) {
    createPlaylistBtn.style.borderColor = `rgba(${theme.primaryRgb}, 0.4)`;
    createPlaylistBtn.style.background = `rgba(${theme.primaryRgb}, 0.2)`;
  }
}

// ====== VIEW FUNCTIONS ======
function setView(view) {
  currentView = view;
  
  document.querySelectorAll('.view-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  switch(view) {
    case 'artists':
      showArtistsView();
      break;
    case 'albums':
      showAllAlbums();
      break;
    case 'chronological':
      showChronological();
      break;
    case 'playlists':
      showPlaylistsView();
      break;
    case 'liked':
      showLikedView();
      break;
  }
}

function showArtistsView() {
  const artistsHTML = library.artists.map((artist, artistIdx) => {
    const albumCount = artist.albums.length;
    const trackCount = artist.albums.reduce((sum, album) => sum + album.tracks.length, 0);
    const initial = artist.name.charAt(0);
    
    const albumsHTML = artist.albums.map((album, albumIdx) => `
      <div class="album-card" onclick="showTracks(${artistIdx}, ${albumIdx})">
        <button class="like-btn ${isAlbumLiked(artistIdx, albumIdx) ? 'liked' : ''}" 
                onclick="toggleAlbumLike(${artistIdx}, ${albumIdx}, event)">
          ${isAlbumLiked(artistIdx, albumIdx) ? '‚ù§Ô∏è' : 'ü§ç'}
        </button>
        <img src="${album.cover}" alt="${album.title}">
        <p class="album-title">${album.title}</p>
        <p class="album-date">${album.displayDate}</p>
      </div>
    `).join('');
    
    return `
      <div class="artist-card" id="artist-${artistIdx}">
        <div class="artist-header" onclick="toggleArtist(${artistIdx})">
          <div class="artist-initial">${initial}</div>
          <div class="artist-info">
            <h2>${artist.name}</h2>
            <p class="artist-meta">${albumCount} ${albumCount === 1 ? 'album' : 'albums'} ‚Ä¢ ${trackCount} tracks</p>
          </div>
          <span class="expand-icon">‚ñº</span>
        </div>
        <div class="artist-albums">
          ${albumsHTML}
        </div>
      </div>
    `;
  }).join('');
  
  viewDiv.innerHTML = `<div class="artists-section">${artistsHTML}</div>`;
  updateThemedElements(library.artists[currentArtistIndex].albums[currentAlbumIndex].theme);
}

function toggleArtist(artistIdx) {
  const card = document.getElementById(`artist-${artistIdx}`);
  card.classList.toggle('expanded');
}

function showAllAlbums() {
  const albums = getAllAlbums();
  
  const albumsHTML = albums.map(album => `
    <div class="album-card" onclick="showTracks(${album.artistIndex}, ${album.albumIndex})">
      <button class="like-btn ${isAlbumLiked(album.artistIndex, album.albumIndex) ? 'liked' : ''}" 
              onclick="toggleAlbumLike(${album.artistIndex}, ${album.albumIndex}, event)">
        ${isAlbumLiked(album.artistIndex, album.albumIndex) ? '‚ù§Ô∏è' : 'ü§ç'}
      </button>
      <img src="${album.cover}" alt="${album.title}">
      <p class="album-title">${album.title}</p>
      <p class="album-artist">${album.artistName}</p>
      <p class="album-date">${album.displayDate}</p>
    </div>
  `).join('');
  
  viewDiv.innerHTML = `<div class="albums-grid">${albumsHTML}</div>`;
  updateThemedElements(library.artists[currentArtistIndex].albums[currentAlbumIndex].theme);
}

function showChronological() {
  const albums = getAlbumsSortedByDate();
  
  const albumsHTML = albums.map(album => `
    <div class="album-card" onclick="showTracks(${album.artistIndex}, ${album.albumIndex})">
      <button class="like-btn ${isAlbumLiked(album.artistIndex, album.albumIndex) ? 'liked' : ''}" 
              onclick="toggleAlbumLike(${album.artistIndex}, ${album.albumIndex}, event)">
        ${isAlbumLiked(album.artistIndex, album.albumIndex) ? '‚ù§Ô∏è' : 'ü§ç'}
      </button>
      <img src="${album.cover}" alt="${album.title}">
      <p class="album-title">${album.title}</p>
      <p class="album-artist">${album.artistName}</p>
      <p class="album-date">${album.displayDate}</p>
    </div>
  `).join('');
  
  viewDiv.innerHTML = `<div class="albums-grid">${albumsHTML}</div>`;
  updateThemedElements(library.artists[currentArtistIndex].albums[currentAlbumIndex].theme);
}

function showPlaylistsView() {
  const theme = library.artists[currentArtistIndex].albums[currentAlbumIndex].theme;
  
  if (playlists.length === 0) {
    viewDiv.innerHTML = `
      <button class="create-playlist-btn" onclick="openCreatePlaylistModal()">
        <span style="font-size: 1.5rem;">‚ûï</span>
        Create Your First Playlist
      </button>
      <div class="empty-state">
        <div class="empty-state-icon">üìù</div>
        <div class="empty-state-text">No playlists yet</div>
        <div class="empty-state-subtext">Create a playlist to organize your favorite tracks</div>
      </div>
    `;
  } else {
    const playlistsHTML = playlists.map(playlist => `
      <div class="playlist-card" onclick="showPlaylist('${playlist.id}')">
        <div class="playlist-header">
          <div class="playlist-icon" style="background: ${theme.primary}; color: ${theme.primary === '#ffffff' ? '#000' : '#fff'};">üìù</div>
          <div class="playlist-info">
            <h3>${playlist.name}</h3>
            <p class="playlist-meta">${playlist.tracks.length} tracks</p>
          </div>
          <button class="playlist-delete-btn" onclick="deletePlaylist('${playlist.id}', event)">üóëÔ∏è</button>
        </div>
      </div>
    `).join('');
    
    viewDiv.innerHTML = `
      <button class="create-playlist-btn" onclick="openCreatePlaylistModal()">
        <span style="font-size: 1.5rem;">‚ûï</span>
        Create New Playlist
      </button>
      <div class="playlists-section">
        ${playlistsHTML}
      </div>
    `;
  }
  
  updateThemedElements(theme);
}

function showLikedView() {
  const theme = library.artists[currentArtistIndex].albums[currentAlbumIndex].theme;
  
  // Get liked albums
  const likedAlbumsData = likedAlbums.map(key => {
    const [artistIdx, albumIdx] = key.split('-').map(Number);
    const artist = library.artists[artistIdx];
    const album = artist.albums[albumIdx];
    return {
      ...album,
      artistName: artist.name,
      artistIndex: artistIdx,
      albumIndex: albumIdx
    };
  });
  
  // Get liked songs
  const likedSongsData = likedSongs.map(key => {
    const [artistIdx, albumIdx, trackIdx] = key.split('-').map(Number);
    const artist = library.artists[artistIdx];
    const album = artist.albums[albumIdx];
    const track = album.tracks[trackIdx];
    return {
      artistIdx,
      albumIdx,
      trackIdx,
      artistName: artist.name,
      albumTitle: album.title,
      trackTitle: track.title,
      file: track.file
    };
  });
  
  if (likedAlbumsData.length === 0 && likedSongsData.length === 0) {
    viewDiv.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">‚ù§Ô∏è</div>
        <div class="empty-state-text">No liked albums or songs yet</div>
        <div class="empty-state-subtext">Start liking your favorites to see them here</div>
      </div>
    `;
    updateThemedElements(theme);
    return;
  }
  
  let html = '';
  
  if (likedAlbumsData.length > 0) {
    const albumsHTML = likedAlbumsData.map(album => `
      <div class="album-card" onclick="showTracks(${album.artistIndex}, ${album.albumIndex})">
        <button class="like-btn liked" onclick="toggleAlbumLike(${album.artistIndex}, ${album.albumIndex}, event)">‚ù§Ô∏è</button>
        <img src="${album.cover}" alt="${album.title}">
        <p class="album-title">${album.title}</p>
        <p class="album-artist">${album.artistName}</p>
        <p class="album-date">${album.displayDate}</p>
      </div>
    `).join('');
    
    html += `
      <h2 style="color: white; margin-bottom: 20px; font-size: 1.5rem;">‚ù§Ô∏è Liked Albums</h2>
      <div class="albums-grid">${albumsHTML}</div>
    `;
  }
  
  if (likedSongsData.length > 0) {
    const songsHTML = likedSongsData.map((track, idx) => `
      <div class="track-item" onclick="playLikedTrack(${idx})">
        <span class="track-number">${idx + 1}</span>
        <span class="track-title">${track.trackTitle}</span>
        <span style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">${track.artistName} ‚Ä¢ ${track.albumTitle}</span>
        <div class="track-actions">
          <button class="track-like-btn liked" onclick="toggleTrackLike(${track.artistIdx}, ${track.albumIdx}, ${track.trackIdx}, event)">‚ù§Ô∏è</button>
          <span class="play-icon">‚ñ∂</span>
        </div>
      </div>
    `).join('');
    
    html += `
      <h2 style="color: white; margin: 40px 0 20px; font-size: 1.5rem;">‚ù§Ô∏è Liked Songs</h2>
      <div class="tracks">${songsHTML}</div>
    `;
  }
  
  viewDiv.innerHTML = html;
  updateThemedElements(theme);
}

function playLikedTrack(index) {
  const likedSongsData = likedSongs.map(key => {
    const [artistIdx, albumIdx, trackIdx] = key.split('-').map(Number);
    return { artistIdx, albumIdx, trackIdx };
  });
  
  const track = likedSongsData[index];
  
  // Clear playlist context when playing from liked songs
  currentPlaylistId = null;
  currentPlaylistIndex = -1;
  
  currentArtistIndex = track.artistIdx;
  currentAlbumIndex = track.albumIdx;
  currentTrackIndex = track.trackIdx;
  
  applyTheme(currentArtistIndex, currentAlbumIndex);
  loadTrack();
  audio.play();
}

function showTracks(artistIdx, albumIdx) {
  // Clear playlist context when viewing an album
  currentPlaylistId = null;
  currentPlaylistIndex = -1;
  
  currentArtistIndex = artistIdx;
  currentAlbumIndex = albumIdx;
  const artist = library.artists[artistIdx];
  const album = artist.albums[albumIdx];
  applyTheme(artistIdx, albumIdx);
  
  if (isShuffleOn) {
    createShuffleOrder();
  }
  
  const tracksHTML = album.tracks.map((track, i) => `
    <div class="track-item" onclick="playTrack(${i})">
      <span class="track-number">${i + 1}</span>
      <span class="track-title">${track.title}</span>
      <div class="track-actions">
        <button class="track-like-btn ${isTrackLiked(artistIdx, albumIdx, i) ? 'liked' : ''}" 
                onclick="toggleTrackLike(${artistIdx}, ${albumIdx}, ${i}, event)">
          ${isTrackLiked(artistIdx, albumIdx, i) ? '‚ù§Ô∏è' : 'ü§ç'}
        </button>
        <span class="play-icon">‚ñ∂</span>
      </div>
    </div>
  `).join('');
  
  viewDiv.innerHTML = `
    <button class="back-btn" onclick="setView('${currentView}')">‚Üê Back</button>
    <div class="track-view">
      <div class="track-header">
        <img src="${album.cover}" alt="${album.title}">
        <div class="track-header-info">
          <h2>${album.title}</h2>
          <p class="artist-name">${artist.name}</p>
          <p class="release-date">${album.displayDate}</p>
        </div>
        <div class="track-header-actions">
          <button class="album-like-btn ${isAlbumLiked(artistIdx, albumIdx) ? 'liked' : ''}" 
                  onclick="toggleAlbumLike(${artistIdx}, ${albumIdx}, event)">
            ${isAlbumLiked(artistIdx, albumIdx) ? '‚ù§Ô∏è Liked' : 'ü§ç Like'}
          </button>
          <button class="add-to-playlist-btn" onclick="openAddToPlaylistModal(${artistIdx}, ${albumIdx})">
            ‚ûï Add to Playlist
          </button>
        </div>
      </div>
      <div class="tracks">
        ${tracksHTML}
      </div>
    </div>
  `;
  
  updateTrackUI();
}

function playTrack(trackIndex) {
  // Clear playlist context when playing from an album
  currentPlaylistId = null;
  currentPlaylistIndex = -1;
  
  currentTrackIndex = trackIndex;
  
  if (isShuffleOn) {
    shuffleIndex = shuffleOrder.indexOf(trackIndex);
  }
  
  loadTrack();
  audio.play();
}

function loadTrack() {
  const artist = library.artists[currentArtistIndex];
  const album = artist.albums[currentAlbumIndex];
  const track = album.tracks[currentTrackIndex];
  audio.src = track.file;
  nowPlayingTitle.textContent = track.title;
  nowPlayingArtist.textContent = artist.name + ' ‚Ä¢ ' + album.title;
  status.textContent = `${artist.name} ‚Ä¢ ${album.title} ‚Ä¢ ${track.title}`;
  updateTrackUI();
}

function updateTrackUI() {
  const trackItems = document.querySelectorAll(".track-item");
  const theme = library.artists[currentArtistIndex].albums[currentAlbumIndex].theme;
  
  trackItems.forEach((el, i) => {
    if (i === currentTrackIndex) {
      el.classList.add("current");
      el.style.background = `rgba(${theme.primaryRgb}, 0.25)`;
      el.style.borderColor = `rgba(${theme.primaryRgb}, 0.6)`;
    } else {
      el.classList.remove("current");
      el.style.background = "rgba(0, 0, 0, 0.3)";
      el.style.borderColor = "transparent";
    }
  });
  
  document.querySelectorAll('.track-number').forEach((num, i) => {
    if (i === currentTrackIndex) {
      num.style.color = theme.primary;
    } else {
      num.style.color = `rgba(${theme.primaryRgb}, 0.7)`;
    }
  });
}

function playPause() {
  const playBtn = document.querySelector(".play-pause");
  
  if (audio.src) {
    if (audio.paused) {
      audio.play();
      playBtn.textContent = "‚è∏";
      status.textContent = "‚ñ∂ Playing";
    } else {
      audio.pause();
      playBtn.textContent = "‚ñ∂";
      status.textContent = "‚è∏ Paused";
    }
  } else {
    currentArtistIndex = 0;
    currentAlbumIndex = 0;
    currentTrackIndex = 0;
    currentPlaylistId = null;
    currentPlaylistIndex = -1;
    applyTheme(0, 0);
    loadTrack();
    audio.play();
    playBtn.textContent = "‚è∏";
  }
}

function createShuffleOrder() {
  const album = library.artists[currentArtistIndex].albums[currentAlbumIndex];
  const trackCount = album.tracks.length;
  
  shuffleOrder = Array.from({length: trackCount}, (_, i) => i);
  
  for (let i = shuffleOrder.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffleOrder[i], shuffleOrder[j]] = [shuffleOrder[j], shuffleOrder[i]];
  }
  
  shuffleIndex = shuffleOrder.indexOf(currentTrackIndex);
}

function toggleShuffle() {
  isShuffleOn = !isShuffleOn;
  const shuffleBtn = document.getElementById('shuffleBtn');
  const theme = library.artists[currentArtistIndex].albums[currentAlbumIndex].theme;
  
  if (isShuffleOn) {
    createShuffleOrder();
    shuffleBtn.style.background = theme.primary;
    shuffleBtn.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
    shuffleBtn.title = 'Shuffle On';
    status.textContent = 'üîÄ Shuffle On';
  } else {
    shuffleBtn.style.background = 'rgba(0, 0, 0, 0.5)';
    shuffleBtn.style.color = theme.primary;
    shuffleBtn.title = 'Shuffle';
    status.textContent = 'üîÄ Shuffle Off';
  }
}

function toggleRepeat() {
  const repeatBtn = document.getElementById('repeatBtn');
  const theme = library.artists[currentArtistIndex].albums[currentAlbumIndex].theme;
  
  if (repeatMode === 'off') {
    repeatMode = 'all';
    repeatBtn.textContent = 'üîÅ';
    repeatBtn.style.background = theme.primary;
    repeatBtn.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
    repeatBtn.title = 'Repeat All';
    status.textContent = 'üîÅ Repeat All';
  } else if (repeatMode === 'all') {
    repeatMode = 'one';
    repeatBtn.textContent = 'üîÇ';
    repeatBtn.title = 'Repeat One';
    status.textContent = 'üîÇ Repeat One';
  } else {
    repeatMode = 'off';
    repeatBtn.textContent = 'üîÅ';
    repeatBtn.style.background = 'rgba(0, 0, 0, 0.5)';
    repeatBtn.style.color = theme.primary;
    repeatBtn.title = 'Repeat Off';
    status.textContent = 'üîÅ Repeat Off';
  }
}

function next() {
  // Check if we're in playlist mode
  if (currentPlaylistId) {
    const playlist = playlists.find(p => p.id === currentPlaylistId);
    if (playlist && currentPlaylistIndex < playlist.tracks.length - 1) {
      // Move to next track in playlist
      currentPlaylistIndex++;
      const track = playlist.tracks[currentPlaylistIndex];
      
      currentArtistIndex = track.artistIdx;
      currentAlbumIndex = track.albumIdx;
      currentTrackIndex = track.trackIdx;
      
      applyTheme(currentArtistIndex, currentAlbumIndex);
      loadTrack();
      audio.play();
      document.querySelector(".play-pause").textContent = "‚è∏";
      return;
    } else if (playlist && repeatMode === 'all') {
      // Loop back to start of playlist
      currentPlaylistIndex = 0;
      const track = playlist.tracks[currentPlaylistIndex];
      
      currentArtistIndex = track.artistIdx;
      currentAlbumIndex = track.albumIdx;
      currentTrackIndex = track.trackIdx;
      
      applyTheme(currentArtistIndex, currentAlbumIndex);
      loadTrack();
      audio.play();
      document.querySelector(".play-pause").textContent = "‚è∏";
      return;
    }
  }
  
  // Regular album mode
  const album = library.artists[currentArtistIndex].albums[currentAlbumIndex];
  
  if (isShuffleOn) {
    shuffleIndex = (shuffleIndex + 1) % shuffleOrder.length;
    currentTrackIndex = shuffleOrder[shuffleIndex];
  } else {
    currentTrackIndex = (currentTrackIndex + 1) % album.tracks.length;
  }
  
  loadTrack();
  audio.play();
  document.querySelector(".play-pause").textContent = "‚è∏";
}

function prev() {
  // Check if we're in playlist mode
  if (currentPlaylistId) {
    const playlist = playlists.find(p => p.id === currentPlaylistId);
    if (playlist && currentPlaylistIndex > 0) {
      // Move to previous track in playlist
      currentPlaylistIndex--;
      const track = playlist.tracks[currentPlaylistIndex];
      
      currentArtistIndex = track.artistIdx;
      currentAlbumIndex = track.albumIdx;
      currentTrackIndex = track.trackIdx;
      
      applyTheme(currentArtistIndex, currentAlbumIndex);
      loadTrack();
      audio.play();
      document.querySelector(".play-pause").textContent = "‚è∏";
      return;
    } else if (playlist && repeatMode === 'all') {
      // Loop to end of playlist
      currentPlaylistIndex = playlist.tracks.length - 1;
      const track = playlist.tracks[currentPlaylistIndex];
      
      currentArtistIndex = track.artistIdx;
      currentAlbumIndex = track.albumIdx;
      currentTrackIndex = track.trackIdx;
      
      applyTheme(currentArtistIndex, currentAlbumIndex);
      loadTrack();
      audio.play();
      document.querySelector(".play-pause").textContent = "‚è∏";
      return;
    }
  }
  
  // Regular album mode
  const album = library.artists[currentArtistIndex].albums[currentAlbumIndex];
  
  if (isShuffleOn) {
    shuffleIndex = (shuffleIndex - 1 + shuffleOrder.length) % shuffleOrder.length;
    currentTrackIndex = shuffleOrder[shuffleIndex];
  } else {
    currentTrackIndex = (currentTrackIndex - 1 + album.tracks.length) % album.tracks.length;
  }
  
  loadTrack();
  audio.play();
  document.querySelector(".play-pause").textContent = "‚è∏";
}

function formatTime(seconds) {
  if (isNaN(seconds)) return "0:00";
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}

function updateVolumeDisplay() {
  const percent = Math.round(audio.volume * 100);
  volumeFill.style.width = percent + '%';
  volumePercentage.textContent = percent + '%';
  
  if (audio.volume === 0) {
    volumeIcon.textContent = 'üîá';
  } else if (audio.volume < 0.5) {
    volumeIcon.textContent = 'üîâ';
  } else {
    volumeIcon.textContent = 'üîä';
  }
}

function toggleMute() {
  if (audio.volume > 0) {
    previousVolume = audio.volume;
    audio.volume = 0;
  } else {
    audio.volume = previousVolume;
  }
  updateVolumeDisplay();
}

volumeSlider.addEventListener('click', (e) => {
  const rect = volumeSlider.getBoundingClientRect();
  const percent = (e.clientX - rect.left) / rect.width;
  audio.volume = Math.max(0, Math.min(1, percent));
  updateVolumeDisplay();
});

progressBar.addEventListener('click', (e) => {
  if (!audio.src) return;
  
  const rect = progressBar.getBoundingClientRect();
  const percent = (e.clientX - rect.left) / rect.width;
  const newTime = percent * audio.duration;
  
  audio.currentTime = newTime;
});

audio.addEventListener("loadedmetadata", () => {
  durationEl.textContent = formatTime(audio.duration);
});

audio.addEventListener("timeupdate", () => {
  if (audio.duration) {
    const percent = (audio.currentTime / audio.duration) * 100;
    progressFill.style.width = percent + '%';
    currentTimeEl.textContent = formatTime(audio.currentTime);
  }
});

audio.addEventListener("ended", () => {
  if (repeatMode === 'one') {
    audio.currentTime = 0;
    audio.play();
  } else {
    // This will now properly handle playlist context
    next();
  }
});

audio.addEventListener("play", () => {
  document.querySelector(".play-pause").textContent = "‚è∏";
  status.textContent = "‚ñ∂ Playing";
});

audio.addEventListener("pause", () => {
  document.querySelector(".play-pause").textContent = "‚ñ∂";
  status.textContent = "‚è∏ Paused";
});

audio.addEventListener("volumechange", () => {
  updateVolumeDisplay();
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  if (e.target.tagName === 'INPUT') return;
  
  switch(e.key) {
    case ' ':
      e.preventDefault();
      playPause();
      break;
    case 'ArrowRight':
      next();
      break;
    case 'ArrowLeft':
      prev();
      break;
  }
});

// Initialize
applyTheme(0, 0);
showArtistsView();
updateVolumeDisplay();
</script>

</body>
</html>
