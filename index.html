<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Player</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    position: relative;
    overflow-x: hidden;
    transition: background 0.6s ease;
  }

  body::before {
    content: '';
    position: fixed;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
    background-size: 50px 50px;
    animation: backgroundMove 20s linear infinite;
    pointer-events: none;
  }

  @keyframes backgroundMove {
    0% { transform: translate(0, 0); }
    100% { transform: translate(50px, 50px); }
  }

  .container {
    max-width: 1200px;
    width: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 40px;
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.6);
    position: relative;
    z-index: 1;
    transition: border 0.6s ease;
  }

  h1 {
    color: white;
    font-size: 2.5rem;
    margin-bottom: 30px;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    font-weight: 700;
  }

  .view-controls {
    display: flex;
    gap: 12px;
    margin-bottom: 30px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .view-btn {
    padding: 12px 28px;
    border: 1px solid;
    color: white;
    cursor: pointer;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .view-btn:hover {
    transform: translateY(-2px);
  }

  .view-btn.active {
    transform: translateY(-2px);
  }

  /* Filter Controls */
  .filter-section {
    margin-bottom: 30px;
  }

  .filter-group {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 16px;
  }

  .filter-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
    text-align: center;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .filter-btn {
    padding: 8px 20px;
    border: 1px solid;
    color: white;
    cursor: pointer;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .filter-btn:hover {
    transform: translateY(-2px);
  }

  .filter-btn.active {
    transform: translateY(-2px);
  }

  /* Artists Grid */
  .artists-section {
    margin-bottom: 30px;
  }

  .artist-card {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
    border: 1px solid;
    backdrop-filter: blur(10px);
  }

  .artist-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .artist-header:hover {
    transform: translateX(4px);
  }

  .artist-initial {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    font-weight: 700;
    color: white;
    flex-shrink: 0;
  }

  .artist-info h2 {
    color: white;
    font-size: 1.8rem;
    margin-bottom: 4px;
  }

  .artist-meta {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.95rem;
  }

  .expand-icon {
    margin-left: auto;
    color: white;
    font-size: 1.5rem;
    transition: transform 0.3s ease;
  }

  .artist-card.expanded .expand-icon {
    transform: rotate(180deg);
  }

  .artist-albums {
    display: none;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .artist-card.expanded .artist-albums {
    display: grid;
  }

  /* Albums Grid */
  .albums-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 24px;
    margin-bottom: 30px;
  }

  .album-card {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 16px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid;
    backdrop-filter: blur(10px);
  }

  .album-card:hover {
    transform: translateY(-8px);
  }

  .album-card img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-radius: 12px;
    margin-bottom: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }

  .album-card .album-title {
    color: white;
    font-weight: 600;
    font-size: 1.1rem;
    text-align: center;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    margin-bottom: 4px;
  }

  .album-card .album-artist {
    color: rgba(255, 255, 255, 0.85);
    font-size: 0.95rem;
    font-weight: 500;
    text-align: center;
    margin-bottom: 8px;
  }

  .album-date {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    font-weight: 400;
    text-align: center;
  }

  /* Track List */
  .track-view {
    animation: fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .track-header {
    display: flex;
    align-items: center;
    gap: 24px;
    margin-bottom: 30px;
    padding: 24px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 16px;
    backdrop-filter: blur(10px);
    border: 1px solid;
  }

  .track-header img {
    width: 150px;
    height: 150px;
    border-radius: 12px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.3);
  }

  .track-header h2 {
    color: white;
    font-size: 2rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    margin-bottom: 4px;
  }

  .track-header .artist-name {
    color: rgba(255, 255, 255, 0.85);
    font-size: 1.2rem;
    font-weight: 500;
    margin-bottom: 8px;
  }

  .track-header .release-date {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1rem;
    font-weight: 400;
  }

  .tracks {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .track-item {
    padding: 16px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 12px;
    border: 1px solid transparent;
  }

  .track-item:hover {
    transform: translateX(4px);
  }

  .track-number {
    font-weight: 600;
    min-width: 30px;
  }

  .track-title {
    color: white;
    font-weight: 500;
    flex: 1;
  }

  .track-item.current .track-title {
    font-weight: 700;
  }

  .play-icon {
    opacity: 0;
    color: white;
    font-size: 1.2rem;
  }

  .track-item:hover .play-icon,
  .track-item.current .play-icon {
    opacity: 1;
  }

  /* Player Controls */
  .player-section {
    margin-top: 40px;
    padding-top: 30px;
    border-top: 1px solid;
  }

  .now-playing {
    text-align: center;
    margin-bottom: 20px;
  }

  .now-playing-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .now-playing-title {
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  }

  .now-playing-artist {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
    font-weight: 500;
    margin-top: 4px;
  }

  /* Progress Bar */
  .progress-container {
    margin-bottom: 24px;
    padding: 0 8px;
  }

  .time-display {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    font-weight: 500;
  }

  .progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    width: 0%;
    border-radius: 4px;
    transition: width 0.1s linear;
    position: relative;
  }

  .progress-fill::after {
    content: '';
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 14px;
    height: 14px;
    background: white;
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  .progress-bar:hover .progress-fill::after {
    opacity: 1;
  }

  .player-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    margin-bottom: 16px;
  }

  .player-controls button {
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid;
    cursor: pointer;
    border-radius: 50%;
    width: 56px;
    height: 56px;
    font-size: 1.3rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    color: white;
  }

  .player-controls button:hover {
    transform: scale(1.1);
  }

  .player-controls button.play-pause {
    width: 72px;
    height: 72px;
    font-size: 1.8rem;
    border: 2px solid;
  }

  .status {
    text-align: center;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.95rem;
    margin-top: 12px;
  }

  /* Volume Control */
  .volume-control {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-top: 24px;
    padding: 0 20px;
  }

  .volume-icon {
    color: white;
    font-size: 1.2rem;
    min-width: 24px;
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .volume-icon:hover {
    transform: scale(1.1);
  }

  .volume-slider {
    width: 200px;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    position: relative;
    cursor: pointer;
    overflow: hidden;
  }

  .volume-fill {
    height: 100%;
    width: 100%;
    border-radius: 4px;
    transition: width 0.1s ease;
    position: relative;
  }

  .volume-fill::after {
    content: '';
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 14px;
    height: 14px;
    background: white;
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  .volume-slider:hover .volume-fill::after {
    opacity: 1;
  }

  .volume-percentage {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    font-weight: 600;
    min-width: 40px;
    text-align: right;
  }

  .back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid;
    cursor: pointer;
    border-radius: 50px;
    font-size: 0.95rem;
    margin-bottom: 20px;
    transition: all 0.3s ease;
    color: white;
  }

  .back-btn:hover {
    transform: translateX(-4px);
  }

  /* Hidden audio element */
  #audio {
    display: none;
  }

  @media (max-width: 768px) {
    .container {
      padding: 24px;
    }

    h1 {
      font-size: 2rem;
    }

    .albums-grid,
    .artist-albums {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
    }

    .track-header {
      flex-direction: column;
      text-align: center;
    }

    .volume-slider {
      width: 120px;
    }

    .artist-header h2 {
      font-size: 1.4rem;
    }

    .artist-initial {
      width: 50px;
      height: 50px;
      font-size: 1.4rem;
    }
  }
</style>
</head>
<body>

<div class="container">
  <h1>üéµ Music Player</h1>

  <div class="view-controls">
    <button class="view-btn active" onclick="setView('artists')">By Artist</button>
    <button class="view-btn" onclick="setView('albums')">All Albums</button>
    <button class="view-btn" onclick="setView('chronological')">Chronological</button>
  </div>

  <div id="view"></div>

  <div class="player-section">
    <div class="now-playing">
      <div class="now-playing-label">Now Playing</div>
      <div class="now-playing-title" id="nowPlayingTitle">Select a track</div>
      <div class="now-playing-artist" id="nowPlayingArtist"></div>
    </div>

    <div class="progress-container">
      <div class="time-display">
        <span id="currentTime">0:00</span>
        <span id="duration">0:00</span>
      </div>
      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <div class="player-controls">
      <button onclick="toggleShuffle()" id="shuffleBtn" title="Shuffle">üîÄ</button>
      <button onclick="prev()" title="Previous">‚èÆ</button>
      <button class="play-pause" onclick="playPause()" title="Play/Pause">‚ñ∂</button>
      <button onclick="next()" title="Next">‚è≠</button>
      <button onclick="toggleRepeat()" id="repeatBtn" title="Repeat Off">üîÅ</button>
    </div>

    <p class="status" id="status">Ready to play</p>

    <div class="volume-control">
      <span class="volume-icon" onclick="toggleMute()" id="volumeIcon">üîä</span>
      <div class="volume-slider" id="volumeSlider">
        <div class="volume-fill" id="volumeFill"></div>
      </div>
      <span class="volume-percentage" id="volumePercentage">100%</span>
    </div>
  </div>
</div>

<audio id="audio"></audio>

<script>
// ====== DATA ======
const library = {
  artists: [
    {
      name: "Nirvana",
      albums: [
        {
          title: "Bleach",
          cover: "71ThvtmT-FL._SL1417_.jpg",
          releaseDate: "1989-06-15",
          displayDate: "June 15, 1989",
          theme: {
            background: "linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #2d2d2d 100%)",
            primary: "#ffffff",
            primaryRgb: "255, 255, 255",
            accent: "#cccccc"
          },
          tracks: [
            {title: "Blew", file: "audio/blew.m4a"},
            {title: "Floyd the Barber", file: "audio/barber.m4a"},
            {title: "About a Girl", file: "audio/abt.m4a"},
            {title: "School", file: "audio/school.m4a"},
            {title: "Love Buzz", file: "audio/lovebuzz.m4a"},
            {title: "Paper Cuts", file: "audio/paper.m4a"},
            {title: "Negative Creep", file: "audio/negative.m4a"},
            {title: "Scoff", file: "audio/scoff.m4a"},
            {title: "Swap Meet", file: "audio/swap.m4a"},
            {title: "Mr. Moustache", file: "audio/mrm.m4a"},
            {title: "Sifting", file: "audio/sift.m4a"},
            {title: "Big Cheese", file: "audio/bigcheese.m4a"},
            {title: "Downer", file: "audio/down.m4a"},
          ]
        },
        {
          title: "Nevermind",
          cover: "https://upload.wikimedia.org/wikipedia/en/b/b7/NirvanaNevermindalbumcover.jpg",
          releaseDate: "1991-09-24",
          displayDate: "September 24, 1991",
          theme: {
            background: "linear-gradient(135deg, #1e3a5f 0%, #2d5a8c 50%, #4a7ba7 100%)",
            primary: "#4a7ba7",
            primaryRgb: "74, 123, 167",
            accent: "#6ba3d4"
          },
          tracks: [
            {title: "Smells Like Teen Spirit", file: "audio/smells_like_teen_spirit.mp3"},
            {title: "In Bloom", file: "audio/in_bloom.mp3"},
            {title: "Come As You Are", file: "audio/come_as_you_are.mp3"},
            {title: "Breed", file: "audio/breed.mp3"},
            {title: "Lithium", file: "audio/lithium.m4a"},
            {title: "Polly", file: "audio/polly.m4a"},
            {title: "Territorial Pissing", file: "audio/territorial_pissings.m4a"},
            {title: "Drain You", file: "audio/drain_you.mp3"},
            {title: "Lounge Act", file: "audio/lounge_act.mp3"},
            {title: "Stay Away", file: "audio/stay_away.m4a"},
            {title: "On A Plain", file: "audio/on_a_plain.m4a"},
            {title: "Something In The Way", file: "audio/something_in_the_way.m4a"},
          ]
        },
        {
          title: "In Utero",
          cover: "ab67616d0000b273c4f52ef8782f0e8ede4c1aaf.jfif",
          releaseDate: "1993-09-21",
          displayDate: "September 21, 1993",
          theme: {
            background: "linear-gradient(135deg, #e8dcc0 0%, #d4c4a0 50%, #c0b090 100%)",
            primary: "#7a3e3e",
            primaryRgb: "122, 62, 62",
            accent: "#9a5555"
          },
          tracks: [
            {title: "Serve The Servants", file: "audio/serve.m4a"},
            {title: "Scentless Apprentice", file: "audio/scentless.m4a"},
            {title: "Heart Shaped Box", file: "audio/hear.m4a"},
            {title: "Rape Me", file: "audio/me.m4a"},
            {title: "Frances Farmer Will Have Her Revenge On Seattle", file: "audio/frances.m4a"},
            {title: "Dumb", file: "audio/dumb.m4a"},
            {title: "Very Ape", file: "audio/very.m4a"},
            {title: "Milk It", file: "audio/milk.m4a"},
            {title: "Pennyroyal Tea", file: "audio/penny.m4a"},
            {title: "Radio Friendly Unit Shifter", file: "audio/radio.m4a"},
            {title: "Tourette's", file: "audio/tour.m4a"},
            {title: "All Apologies", file: "audio/apologies.m4a"},
          ]
        }
      ]
    }
    // Add more artists here in the same format
    // Example:
    // {
    //   name: "Artist Name",
    //   albums: [
    //     {
    //       title: "Album Title",
    //       cover: "cover.jpg",
    //       releaseDate: "YYYY-MM-DD",
    //       displayDate: "Month Day, Year",
    //       theme: { ... },
    //       tracks: [ ... ]
    //     }
    //   ]
    // }
  ]
};

let currentView = 'artists';
let currentArtistIndex = 0;
let currentAlbumIndex = 0;
let currentTrackIndex = 0;
const audio = document.getElementById("audio");
const viewDiv = document.getElementById("view");
const status = document.getElementById("status");
const nowPlayingTitle = document.getElementById("nowPlayingTitle");
const nowPlayingArtist = document.getElementById("nowPlayingArtist");
const progressBar = document.getElementById("progressBar");
const progressFill = document.getElementById("progressFill");
const currentTimeEl = document.getElementById("currentTime");
const durationEl = document.getElementById("duration");
const volumeSlider = document.getElementById("volumeSlider");
const volumeFill = document.getElementById("volumeFill");
const volumePercentage = document.getElementById("volumePercentage");
const volumeIcon = document.getElementById("volumeIcon");

// Initialize volume
audio.volume = 1.0;
let previousVolume = 1.0;
let isShuffleOn = false;
let repeatMode = 'off'; // 'off', 'all', 'one'
let shuffleOrder = [];
let shuffleIndex = 0;

// ====== HELPER FUNCTIONS ======
function getAllAlbums() {
  const allAlbums = [];
  library.artists.forEach((artist, artistIdx) => {
    artist.albums.forEach((album, albumIdx) => {
      allAlbums.push({
        ...album,
        artistName: artist.name,
        artistIndex: artistIdx,
        albumIndex: albumIdx
      });
    });
  });
  return allAlbums;
}

function getAlbumsSortedByDate() {
  return getAllAlbums().sort((a, b) => 
    new Date(a.releaseDate) - new Date(b.releaseDate)
  );
}

// ====== THEME FUNCTIONS ======
function applyTheme(artistIdx, albumIdx) {
  const theme = library.artists[artistIdx].albums[albumIdx].theme;
  document.body.style.background = theme.background;
  
  document.documentElement.style.setProperty('--primary-color', theme.primary);
  document.documentElement.style.setProperty('--primary-rgb', theme.primaryRgb);
  document.documentElement.style.setProperty('--accent-color', theme.accent);
  
  const container = document.querySelector('.container');
  container.style.borderColor = `rgba(${theme.primaryRgb}, 0.3)`;
  
  updateThemedElements(theme);
}

function updateThemedElements(theme) {
  // View buttons
  document.querySelectorAll('.view-btn').forEach(btn => {
    btn.style.background = `rgba(${theme.primaryRgb}, 0.2)`;
    btn.style.borderColor = `rgba(${theme.primaryRgb}, 0.4)`;
    if (btn.classList.contains('active')) {
      btn.style.background = theme.primary;
      btn.style.borderColor = `rgba(${theme.primaryRgb}, 0.8)`;
      btn.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
    }
  });
  
  // Filter buttons
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.style.background = `rgba(${theme.primaryRgb}, 0.2)`;
    btn.style.borderColor = `rgba(${theme.primaryRgb}, 0.4)`;
    if (btn.classList.contains('active')) {
      btn.style.background = theme.primary;
      btn.style.borderColor = `rgba(${theme.primaryRgb}, 0.8)`;
      btn.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
    }
  });
  
  // Artist cards
  document.querySelectorAll('.artist-card').forEach(card => {
    card.style.borderColor = `rgba(${theme.primaryRgb}, 0.2)`;
  });
  
  // Artist initials
  document.querySelectorAll('.artist-initial').forEach(initial => {
    initial.style.background = theme.primary;
    initial.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
  });
  
  // Album cards
  document.querySelectorAll('.album-card').forEach(card => {
    card.style.borderColor = `rgba(${theme.primaryRgb}, 0.2)`;
  });
  
  // Track items
  document.querySelectorAll('.track-item').forEach(item => {
    if (item.classList.contains('current')) {
      item.style.background = `rgba(${theme.primaryRgb}, 0.25)`;
      item.style.borderColor = `rgba(${theme.primaryRgb}, 0.6)`;
    }
  });
  
  // Track numbers
  document.querySelectorAll('.track-number').forEach(num => {
    num.style.color = `rgba(${theme.primaryRgb}, 0.7)`;
  });
  
  document.querySelectorAll('.track-item.current .track-number').forEach(num => {
    num.style.color = theme.primary;
  });
  
  // Player section
  const playerSection = document.querySelector('.player-section');
  if (playerSection) {
    playerSection.style.borderTopColor = `rgba(${theme.primaryRgb}, 0.3)`;
  }
  
  // Player controls
  document.querySelectorAll('.player-controls button').forEach(btn => {
    btn.style.borderColor = `rgba(${theme.primaryRgb}, 0.4)`;
    btn.style.color = theme.primary;
    
    if (btn.classList.contains('play-pause')) {
      btn.style.background = theme.primary;
      btn.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
      btn.style.boxShadow = `0 4px 16px rgba(${theme.primaryRgb}, 0.4)`;
    }
  });
  
  // Progress bar
  progressFill.style.background = theme.primary;
  
  // Volume bar
  volumeFill.style.background = theme.primary;
  
  // Back button
  const backBtn = document.querySelector('.back-btn');
  if (backBtn) {
    backBtn.style.borderColor = `rgba(${theme.primaryRgb}, 0.4)`;
    backBtn.style.color = theme.primary;
  }
  
  // Track header
  const trackHeader = document.querySelector('.track-header');
  if (trackHeader) {
    trackHeader.style.borderColor = `rgba(${theme.primaryRgb}, 0.3)`;
  }
}

// ====== VIEW FUNCTIONS ======
function setView(view) {
  currentView = view;
  
  // Update button states
  document.querySelectorAll('.view-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Show appropriate view
  switch(view) {
    case 'artists':
      showArtistsView();
      break;
    case 'albums':
      showAllAlbums();
      break;
    case 'chronological':
      showChronological();
      break;
  }
}

function showArtistsView() {
  const artistsHTML = library.artists.map((artist, artistIdx) => {
    const albumCount = artist.albums.length;
    const trackCount = artist.albums.reduce((sum, album) => sum + album.tracks.length, 0);
    const initial = artist.name.charAt(0);
    
    const albumsHTML = artist.albums.map((album, albumIdx) => `
      <div class="album-card" onclick="showTracks(${artistIdx}, ${albumIdx})">
        <img src="${album.cover}" alt="${album.title}">
        <p class="album-title">${album.title}</p>
        <p class="album-date">${album.displayDate}</p>
      </div>
    `).join('');
    
    return `
      <div class="artist-card" id="artist-${artistIdx}">
        <div class="artist-header" onclick="toggleArtist(${artistIdx})">
          <div class="artist-initial">${initial}</div>
          <div class="artist-info">
            <h2>${artist.name}</h2>
            <p class="artist-meta">${albumCount} ${albumCount === 1 ? 'album' : 'albums'} ‚Ä¢ ${trackCount} tracks</p>
          </div>
          <span class="expand-icon">‚ñº</span>
        </div>
        <div class="artist-albums">
          ${albumsHTML}
        </div>
      </div>
    `;
  }).join('');
  
  viewDiv.innerHTML = `<div class="artists-section">${artistsHTML}</div>`;
  updateThemedElements(library.artists[currentArtistIndex].albums[currentAlbumIndex].theme);
}

function toggleArtist(artistIdx) {
  const card = document.getElementById(`artist-${artistIdx}`);
  card.classList.toggle('expanded');
}

function showAllAlbums() {
  const albums = getAllAlbums();
  
  const albumsHTML = albums.map(album => `
    <div class="album-card" onclick="showTracks(${album.artistIndex}, ${album.albumIndex})">
      <img src="${album.cover}" alt="${album.title}">
      <p class="album-title">${album.title}</p>
      <p class="album-artist">${album.artistName}</p>
      <p class="album-date">${album.displayDate}</p>
    </div>
  `).join('');
  
  viewDiv.innerHTML = `<div class="albums-grid">${albumsHTML}</div>`;
  updateThemedElements(library.artists[currentArtistIndex].albums[currentAlbumIndex].theme);
}

function showChronological() {
  const albums = getAlbumsSortedByDate();
  
  const albumsHTML = albums.map(album => `
    <div class="album-card" onclick="showTracks(${album.artistIndex}, ${album.albumIndex})">
      <img src="${album.cover}" alt="${album.title}">
      <p class="album-title">${album.title}</p>
      <p class="album-artist">${album.artistName}</p>
      <p class="album-date">${album.displayDate}</p>
    </div>
  `).join('');
  
  viewDiv.innerHTML = `<div class="albums-grid">${albumsHTML}</div>`;
  updateThemedElements(library.artists[currentArtistIndex].albums[currentAlbumIndex].theme);
}

// Show tracks for an album
function showTracks(artistIdx, albumIdx) {
  currentArtistIndex = artistIdx;
  currentAlbumIndex = albumIdx;
  const artist = library.artists[artistIdx];
  const album = artist.albums[albumIdx];
  applyTheme(artistIdx, albumIdx);
  
  // Reset shuffle when changing albums
  if (isShuffleOn) {
    createShuffleOrder();
  }
  
  viewDiv.innerHTML = `
    <button class="back-btn" onclick="setView('${currentView}')">‚Üê Back</button>
    <div class="track-view">
      <div class="track-header">
        <img src="${album.cover}" alt="${album.title}">
        <div>
          <h2>${album.title}</h2>
          <p class="artist-name">${artist.name}</p>
          <p class="release-date">${album.displayDate}</p>
        </div>
      </div>
      <div class="tracks">
        ${album.tracks.map((track, i) => `
          <div class="track-item" onclick="playTrack(${i})">
            <span class="track-number">${i + 1}</span>
            <span class="track-title">${track.title}</span>
            <span class="play-icon">‚ñ∂</span>
          </div>
        `).join('')}
      </div>
    </div>
  `;
  
  updateTrackUI();
}

// Play specific track
function playTrack(trackIndex) {
  currentTrackIndex = trackIndex;
  
  // Update shuffle index if shuffle is on
  if (isShuffleOn) {
    shuffleIndex = shuffleOrder.indexOf(trackIndex);
  }
  
  loadTrack();
  audio.play();
}

// Load current track
function loadTrack() {
  const artist = library.artists[currentArtistIndex];
  const album = artist.albums[currentAlbumIndex];
  const track = album.tracks[currentTrackIndex];
  audio.src = track.file;
  nowPlayingTitle.textContent = track.title;
  nowPlayingArtist.textContent = artist.name + ' ‚Ä¢ ' + album.title;
  status.textContent = `${artist.name} ‚Ä¢ ${album.title} ‚Ä¢ ${track.title}`;
  updateTrackUI();
}

// Update track list highlighting
function updateTrackUI() {
  const trackItems = document.querySelectorAll(".track-item");
  const theme = library.artists[currentArtistIndex].albums[currentAlbumIndex].theme;
  
  trackItems.forEach((el, i) => {
    if (i === currentTrackIndex) {
      el.classList.add("current");
      el.style.background = `rgba(${theme.primaryRgb}, 0.25)`;
      el.style.borderColor = `rgba(${theme.primaryRgb}, 0.6)`;
    } else {
      el.classList.remove("current");
      el.style.background = "rgba(0, 0, 0, 0.3)";
      el.style.borderColor = "transparent";
    }
  });
  
  // Update track numbers
  document.querySelectorAll('.track-number').forEach((num, i) => {
    if (i === currentTrackIndex) {
      num.style.color = theme.primary;
    } else {
      num.style.color = `rgba(${theme.primaryRgb}, 0.7)`;
    }
  });
}

// Play / pause toggle
function playPause() {
  const playBtn = document.querySelector(".play-pause");
  
  if (audio.src) {
    if (audio.paused) {
      audio.play();
      playBtn.textContent = "‚è∏";
      status.textContent = "‚ñ∂ Playing";
    } else {
      audio.pause();
      playBtn.textContent = "‚ñ∂";
      status.textContent = "‚è∏ Paused";
    }
  } else {
    // Load first track if none selected
    currentArtistIndex = 0;
    currentAlbumIndex = 0;
    currentTrackIndex = 0;
    applyTheme(0, 0);
    loadTrack();
    audio.play();
    playBtn.textContent = "‚è∏";
  }
}

// Shuffle functions
function createShuffleOrder() {
  const album = library.artists[currentArtistIndex].albums[currentAlbumIndex];
  const trackCount = album.tracks.length;
  
  // Create array of indices
  shuffleOrder = Array.from({length: trackCount}, (_, i) => i);
  
  // Fisher-Yates shuffle
  for (let i = shuffleOrder.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffleOrder[i], shuffleOrder[j]] = [shuffleOrder[j], shuffleOrder[i]];
  }
  
  // Find current track in shuffle order
  shuffleIndex = shuffleOrder.indexOf(currentTrackIndex);
}

function toggleShuffle() {
  isShuffleOn = !isShuffleOn;
  const shuffleBtn = document.getElementById('shuffleBtn');
  const theme = library.artists[currentArtistIndex].albums[currentAlbumIndex].theme;
  
  if (isShuffleOn) {
    createShuffleOrder();
    shuffleBtn.style.background = theme.primary;
    shuffleBtn.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
    shuffleBtn.title = 'Shuffle On';
    status.textContent = 'üîÄ Shuffle On';
  } else {
    shuffleBtn.style.background = 'rgba(0, 0, 0, 0.5)';
    shuffleBtn.style.color = theme.primary;
    shuffleBtn.title = 'Shuffle';
    status.textContent = 'üîÄ Shuffle Off';
  }
}

function toggleRepeat() {
  const repeatBtn = document.getElementById('repeatBtn');
  const theme = library.artists[currentArtistIndex].albums[currentAlbumIndex].theme;
  
  if (repeatMode === 'off') {
    repeatMode = 'all';
    repeatBtn.textContent = 'üîÅ';
    repeatBtn.style.background = theme.primary;
    repeatBtn.style.color = theme.primary === '#ffffff' ? '#000' : '#fff';
    repeatBtn.title = 'Repeat All';
    status.textContent = 'üîÅ Repeat All';
  } else if (repeatMode === 'all') {
    repeatMode = 'one';
    repeatBtn.textContent = 'üîÇ';
    repeatBtn.title = 'Repeat One';
    status.textContent = 'üîÇ Repeat One';
  } else {
    repeatMode = 'off';
    repeatBtn.textContent = 'üîÅ';
    repeatBtn.style.background = 'rgba(0, 0, 0, 0.5)';
    repeatBtn.style.color = theme.primary;
    repeatBtn.title = 'Repeat Off';
    status.textContent = 'üîÅ Repeat Off';
  }
}

// Next / Prev
function next() {
  const album = library.artists[currentArtistIndex].albums[currentAlbumIndex];
  
  if (isShuffleOn) {
    shuffleIndex = (shuffleIndex + 1) % shuffleOrder.length;
    currentTrackIndex = shuffleOrder[shuffleIndex];
  } else {
    currentTrackIndex = (currentTrackIndex + 1) % album.tracks.length;
  }
  
  loadTrack();
  audio.play();
  document.querySelector(".play-pause").textContent = "‚è∏";
}

function prev() {
  const album = library.artists[currentArtistIndex].albums[currentAlbumIndex];
  
  if (isShuffleOn) {
    shuffleIndex = (shuffleIndex - 1 + shuffleOrder.length) % shuffleOrder.length;
    currentTrackIndex = shuffleOrder[shuffleIndex];
  } else {
    currentTrackIndex = (currentTrackIndex - 1 + album.tracks.length) % album.tracks.length;
  }
  
  loadTrack();
  audio.play();
  document.querySelector(".play-pause").textContent = "‚è∏";
}

// Format time (seconds to mm:ss)
function formatTime(seconds) {
  if (isNaN(seconds)) return "0:00";
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}

// ====== VOLUME CONTROLS ======
function updateVolumeDisplay() {
  const percent = Math.round(audio.volume * 100);
  volumeFill.style.width = percent + '%';
  volumePercentage.textContent = percent + '%';
  
  if (audio.volume === 0) {
    volumeIcon.textContent = 'üîá';
  } else if (audio.volume < 0.5) {
    volumeIcon.textContent = 'üîâ';
  } else {
    volumeIcon.textContent = 'üîä';
  }
}

function toggleMute() {
  if (audio.volume > 0) {
    previousVolume = audio.volume;
    audio.volume = 0;
  } else {
    audio.volume = previousVolume;
  }
  updateVolumeDisplay();
}

volumeSlider.addEventListener('click', (e) => {
  const rect = volumeSlider.getBoundingClientRect();
  const percent = (e.clientX - rect.left) / rect.width;
  audio.volume = Math.max(0, Math.min(1, percent));
  updateVolumeDisplay();
});

// ====== PROGRESS BAR INTERACTION ======
progressBar.addEventListener('click', (e) => {
  if (!audio.src) return;
  
  const rect = progressBar.getBoundingClientRect();
  const percent = (e.clientX - rect.left) / rect.width;
  const newTime = percent * audio.duration;
  
  audio.currentTime = newTime;
});

// ====== AUDIO EVENTS ======
audio.addEventListener("loadedmetadata", () => {
  durationEl.textContent = formatTime(audio.duration);
});

audio.addEventListener("timeupdate", () => {
  if (audio.duration) {
    const percent = (audio.currentTime / audio.duration) * 100;
    progressFill.style.width = percent + '%';
    currentTimeEl.textContent = formatTime(audio.currentTime);
  }
});

audio.addEventListener("ended", () => {
  if (repeatMode === 'one') {
    audio.currentTime = 0;
    audio.play();
  } else {
    next();
  }
});

audio.addEventListener("play", () => {
  document.querySelector(".play-pause").textContent = "‚è∏";
  status.textContent = "‚ñ∂ Playing";
});

audio.addEventListener("pause", () => {
  document.querySelector(".play-pause").textContent = "‚ñ∂";
  status.textContent = "‚è∏ Paused";
});

audio.addEventListener("volumechange", () => {
  updateVolumeDisplay();
});

// Initialize
applyTheme(0, 0);
showArtistsView();
updateVolumeDisplay();
</script>

</body>
</html>
